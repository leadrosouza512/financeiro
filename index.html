<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinControl Ultimate</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* --- 1. CONFIGURA√á√ïES VISUAIS --- */
        :root {
            --primary: #820ad1; --secondary: #00d283; --danger: #ff4757; 
            --dark: #1e272e; --gray: #808e9b; --light: #f3f4f6; --white: #ffffff;
            --text: #1e272e; --shadow: 0 4px 15px rgba(0,0,0,0.05);
        }
        [data-theme="dark"] {
            --light: #121212; --white: #1e1e1e; --text: #f3f4f6;
            --gray: #a4b0be; --shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: var(--light); color: var(--text); height: 100vh; overflow: hidden; }
        
        /* --- 2. LAYOUT --- */
        .app-container { display: flex; height: 100%; }
        
        /* MENU LATERAL */
        #sidebar {
            width: 260px; background: var(--white); display: flex; flex-direction: column;
            border-right: 1px solid var(--gray); z-index: 2000; transition: transform 0.3s ease;
        }
        .brand { padding: 25px; font-size: 1.5rem; font-weight: 800; color: var(--primary); display: flex; align-items: center; gap: 10px; }
        .menu-list { list-style: none; padding: 0 15px; margin-top: 20px; }
        .menu-link {
            display: flex; align-items: center; padding: 12px 15px; text-decoration: none;
            color: var(--gray); border-radius: 12px; font-weight: 500; cursor: pointer; margin-bottom: 5px; transition: 0.2s;
        }
        .menu-link:hover, .menu-link.active { background: rgba(130, 10, 209, 0.1); color: var(--primary); }
        .menu-icon { margin-right: 12px; font-size: 1.2rem; }

        /* CONTE√öDO */
        .main-content { flex: 1; display: flex; flex-direction: column; overflow: hidden; position: relative; }
        .page-content { flex: 1; overflow-y: auto; padding: 30px; padding-bottom: 80px; }
        header { background: var(--white); padding: 15px 20px; display: none; justify-content: space-between; align-items: center; box-shadow: var(--shadow); z-index: 1000; }

        /* --- 3. MODAIS (As janelas bonitas) --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); z-index: 4000; /* Acima de tudo */
            display: flex; justify-content: center; align-items: center;
            opacity: 0; visibility: hidden; transition: 0.3s;
        }
        .modal-overlay.open { opacity: 1; visibility: visible; }
        
        .modal-box {
            background: var(--white); padding: 25px; border-radius: 16px; width: 90%; max-width: 400px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2); transform: translateY(20px); transition: 0.3s;
        }
        .modal-overlay.open .modal-box { transform: translateY(0); }
        .modal-title { font-size: 1.2rem; font-weight: bold; margin-bottom: 10px; color: var(--text); }
        .modal-body { color: var(--text); margin-bottom: 20px; opacity: 0.8; }
        .modal-input { width: 100%; padding: 10px; border: 1px solid var(--gray); border-radius: 8px; background: var(--light); color: var(--text); margin-top: 10px; }
        
        .modal-actions { display: flex; gap: 10px; justify-content: flex-end; }
        .btn-modal { padding: 10px 20px; border-radius: 8px; border: none; cursor: pointer; font-weight: bold; }
        .btn-cancel { background: transparent; color: var(--gray); }
        .btn-confirm { background: var(--danger); color: white; }
        .btn-save { background: var(--primary); color: white; }

        /* --- 4. COMPONENTES --- */
        .card { background: var(--white); padding: 25px; border-radius: 16px; box-shadow: var(--shadow); margin-bottom: 20px; color: var(--text); }
        .card-total { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; }
        .cards-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .balance { font-size: 2rem; font-weight: bold; }
        
        /* Tabela */
        .table-container { background: var(--white); border-radius: 16px; box-shadow: var(--shadow); padding: 20px; overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; min-width: 500px; }
        td, th { padding: 15px; border-bottom: 1px solid var(--gray); text-align: left; color: var(--text); }
        
        /* Buttons e Forms */
        .btn-submit { width: 100%; padding: 14px; background: var(--primary); color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .form-control { width: 100%; padding: 12px; border: 1px solid var(--gray); background: var(--light); color: var(--text); border-radius: 8px; margin-bottom: 15px; }

        /* Mobile Adjustments */
        #overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1500; opacity: 0; visibility: hidden; transition: 0.3s; }
        #overlay.visible { opacity: 1; visibility: visible; }
        
        @media (max-width: 768px) { 
            #sidebar { position: fixed; top: 0; left: 0; height: 100%; transform: translateX(-100%); }
            #sidebar.open { transform: translateX(0); }
            header { display: flex; }
            .btn-fechar-mobile { display: flex !important; color: var(--danger) !important; justify-content: center; }
        }
        .btn-fechar-mobile { display: none; }
    </style>
</head>
<body>

    <div id="modal-delete" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-title">üóëÔ∏è Excluir Item?</div>
            <div class="modal-body">Voc√™ tem certeza que deseja excluir este item? Essa a√ß√£o n√£o pode ser desfeita.</div>
            <div class="modal-actions">
                <button class="btn-modal btn-cancel" onclick="fecharModal('modal-delete')">Cancelar</button>
                <button class="btn-modal btn-confirm" id="btn-confirm-delete">Sim, Excluir</button>
            </div>
        </div>
    </div>

    <div id="modal-categoria" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-title">üìÇ Nova Categoria</div>
            <div class="modal-body">
                <label>Nome da Categoria:</label>
                <input type="text" id="nova-cat-nome" class="modal-input" placeholder="Ex: Investimentos">
                <br><br>
                <label>Limite de Gastos (R$):</label>
                <input type="number" id="nova-cat-valor" class="modal-input" placeholder="0.00">
            </div>
            <div class="modal-actions">
                <button class="btn-modal btn-cancel" onclick="fecharModal('modal-categoria')">Cancelar</button>
                <button class="btn-modal btn-save" onclick="salvarNovaCategoria()">Criar</button>
            </div>
        </div>
    </div>

    <div class="app-container">
        <div id="overlay" onclick="toggleMenu(false)"></div>

        <nav id="sidebar">
            <div class="brand">üöÄ FinControl</div>
            <ul class="menu-list">
                <li class="menu-item"><a class="menu-link active" onclick="navegar('dashboard', this)">üìä Dashboard</a></li>
                <li class="menu-item"><a class="menu-link" onclick="navegar('lancamentos', this)">üìù Extrato</a></li>
                <li class="menu-item"><a class="menu-link" onclick="navegar('adicionar', this)">‚ûï Novo</a></li>
                <li class="menu-item"><a class="menu-link" onclick="navegar('config', this)">‚öôÔ∏è Config</a></li>
                <li class="menu-item"><a class="menu-link" onclick="alternarTema()">üåì Tema</a></li>
                <li class="menu-item btn-fechar-mobile">
                    <a class="menu-link" onclick="toggleMenu(false)" style="color: var(--danger);">‚úï Fechar Menu</a>
                </li>
            </ul>
        </nav>

        <div class="main-content">
            <header>
                <strong style="color:var(--primary)">FinControl</strong>
                <button onclick="toggleMenu(true)" style="background:none; border:none; font-size: 28px; cursor:pointer;">‚ò∞</button>
            </header>

            <div class="page-content">
                <section id="dashboard" class="screen active">
                    <h2>Vis√£o Geral</h2><br>
                    <div class="cards-grid">
                        <div class="card card-total">
                            <small>Saldo Atual</small>
                            <div class="balance" id="saldo-total">R$ 0,00</div>
                        </div>
                        <div class="card"><small>Receitas</small><div class="balance" style="color:var(--secondary)" id="receitas-total">R$ 0,00</div></div>
                        <div class="card"><small>Despesas</small><div class="balance" style="color:var(--danger)" id="despesas-total">R$ 0,00</div></div>
                    </div>
                    <div class="card" style="height: 300px;">
                        <canvas id="grafico-rosca"></canvas>
                    </div>
                </section>

                <section id="lancamentos" class="screen" style="display:none;">
                    <h2>Extrato</h2><br>
                    <div class="table-container">
                        <table><tbody id="tabela-completa"></tbody></table>
                    </div>
                </section>

                <section id="adicionar" class="screen" style="display:none;">
                    <h2>Nova Transa√ß√£o</h2><br>
                    <div class="card" style="max-width:600px; margin:0 auto;">
                        <form id="form-transacao">
                            <input type="hidden" id="input-id">
                            <select id="input-tipo" class="form-control"><option value="saida">üí∏ Despesa</option><option value="entrada">üí∞ Receita</option></select>
                            <input type="text" id="input-desc" class="form-control" placeholder="Descri√ß√£o" required>
                            <select id="input-categoria" class="form-control"></select>
                            <input type="number" step="0.01" id="input-valor" class="form-control" placeholder="Valor" required>
                            <input type="date" id="input-data" class="form-control" required>
                            <button type="submit" class="btn-submit">Salvar</button>
                        </form>
                    </div>
                </section>

                <section id="config" class="screen" style="display:none;">
                    <h2>Configura√ß√µes</h2><br>
                    <div class="card">
                        <button class="btn-submit" onclick="abrirModalCategoria()" style="background: var(--secondary);">+ Nova Categoria</button>
                        <br><br>
                        <div id="lista-metas-config"></div>
                        <br><hr><br>
                        <button onclick="fazerBackup()" style="padding:10px;">üì• Backup</button>
                        <input type="file" onchange="restaurarBackup(this)">
                    </div>
                </section>
            </div>
        </div>
    </div>

    <script>
        // --- DADOS ---
        let transacoes = [];
        let metas = { 'Moradia': 2000, 'Alimenta√ß√£o': 1000, 'Transporte': 500, 'Lazer': 300, 'Outros': 500 };
        let itemParaDeletar = null; // Guarda o ID temporariamente
        let chartInstance = null;

        // --- INICIALIZA√á√ÉO ---
        function init() {
            const dbData = localStorage.getItem('fin_v6_data');
            const dbMetas = localStorage.getItem('fin_v6_metas');
            if(dbData) transacoes = JSON.parse(dbData);
            if(dbMetas) metas = JSON.parse(dbMetas);
            
            document.getElementById('input-data').value = new Date().toISOString().split('T')[0];
            atualizarSelectCategorias();
            atualizarInterface();
            renderizarMetasConfig();
        }

        // --- SISTEMA DE MODAIS (Adeus prompt/confirm) ---
        function abrirModalDelete(id) {
            itemParaDeletar = id;
            document.getElementById('modal-delete').classList.add('open');
        }

        document.getElementById('btn-confirm-delete').onclick = function() {
            if(itemParaDeletar) {
                transacoes = transacoes.filter(t => t.id !== itemParaDeletar);
                salvarDados();
                fecharModal('modal-delete');
            }
        };

        function abrirModalCategoria() {
            document.getElementById('nova-cat-nome').value = '';
            document.getElementById('nova-cat-valor').value = '';
            document.getElementById('modal-categoria').classList.add('open');
        }

        function salvarNovaCategoria() {
            const nome = document.getElementById('nova-cat-nome').value;
            const valor = parseFloat(document.getElementById('nova-cat-valor').value);
            if(nome && !isNaN(valor)) {
                metas[nome] = valor;
                salvarDados();
                renderizarMetasConfig();
                atualizarSelectCategorias();
                fecharModal('modal-categoria');
            }
        }

        function fecharModal(id) {
            document.getElementById(id).classList.remove('open');
        }

        // --- MENU CORRIGIDO ---
        function toggleMenu(abrir) {
            const sb = document.getElementById('sidebar');
            const ov = document.getElementById('overlay');
            if(abrir) {
                sb.classList.add('open');
                ov.classList.add('visible');
            } else {
                sb.classList.remove('open');
                ov.classList.remove('visible');
            }
        }

        // --- NAVEGA√á√ÉO ---
        function navegar(tela, el) {
            document.querySelectorAll('.screen').forEach(s => s.style.display = 'none');
            document.getElementById(tela).style.display = 'block';
            toggleMenu(false); // Fecha o menu ao clicar
        }

        // --- CORE (Salvar, Atualizar) ---
        function salvarDados() {
            localStorage.setItem('fin_v6_data', JSON.stringify(transacoes));
            localStorage.setItem('fin_v6_metas', JSON.stringify(metas));
            atualizarInterface();
        }

        function atualizarInterface() {
            let ent=0, sai=0, cats={};
            const tb = document.getElementById('tabela-completa');
            tb.innerHTML = '';

            transacoes.forEach(t => {
                const val = Number(t.valor);
                if(t.tipo === 'entrada') ent += val;
                else { sai += val; cats[t.categoria] = (cats[t.categoria] || 0) + val; }

                tb.innerHTML += `
                    <tr>
                        <td>${t.desc}<br><small>${t.data}</small></td>
                        <td style="color:${t.tipo==='entrada'?'var(--secondary)':'var(--danger)'}">R$ ${val.toFixed(2)}</td>
                        <td><button onclick="abrirModalDelete(${t.id})" style="border:none; background:none; cursor:pointer;">üóëÔ∏è</button></td>
                    </tr>`;
            });

            document.getElementById('saldo-total').innerText = `R$ ${(ent-sai).toFixed(2)}`;
            document.getElementById('receitas-total').innerText = `R$ ${ent.toFixed(2)}`;
            document.getElementById('despesas-total').innerText = `R$ ${sai.toFixed(2)}`;
            renderizarGrafico(cats);
        }

        // --- FORMUL√ÅRIO ---
        document.getElementById('form-transacao').addEventListener('submit', function(e) {
            e.preventDefault();
            const form = {
                id: Date.now(),
                desc: document.getElementById('input-desc').value,
                valor: document.getElementById('input-valor').value,
                tipo: document.getElementById('input-tipo').value,
                categoria: document.getElementById('input-categoria').value,
                data: document.getElementById('input-data').value
            };
            transacoes.push(form);
            salvarDados();
            this.reset();
            navegar('dashboard');
        });

        // --- UTILS ---
        function renderizarGrafico(dados) {
            const ctx = document.getElementById('grafico-rosca').getContext('2d');
            if(chartInstance) chartInstance.destroy();
            chartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(dados),
                    datasets: [{ data: Object.values(dados), backgroundColor: ['#ff4757','#2ed573','#ffa502','#1e90ff'] }]
                },
                options: { maintainAspectRatio: false }
            });
        }

        function renderizarMetasConfig() {
            const d = document.getElementById('lista-metas-config');
            d.innerHTML = '';
            for(let c in metas) d.innerHTML += `<div style="padding:10px; border-bottom:1px solid #eee;"><b>${c}</b>: R$ ${metas[c]} <button onclick="delete metas['${c}']; salvarDados(); renderizarMetasConfig();" style="float:right; border:none; background:none;">üóëÔ∏è</button></div>`;
        }

        function atualizarSelectCategorias() {
            const s = document.getElementById('input-categoria');
            s.innerHTML = '';
            for(let c in metas) s.innerHTML += `<option value="${c}">${c}</option>`;
        }
        
        function alternarTema() {
            const b = document.body;
            b.hasAttribute('data-theme') ? b.removeAttribute('data-theme') : b.setAttribute('data-theme','dark');
        }

        function fazerBackup() {
            const a = document.createElement("a");
            a.href = URL.createObjectURL(new Blob([JSON.stringify({transacoes, metas})], {type:"application/json"}));
            a.download = "backup.json";
            a.click();
        }

        // INICIAR
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
