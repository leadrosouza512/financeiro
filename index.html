<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinControl Pro - Cart√µes</title>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* --- 1. DESIGN SYSTEM --- */
        :root {
            --primary: #1a73e8; 
            --accent-green: #28a745; --accent-red: #dc3545; --accent-purple: #6f42c1;
            --bg-body: #f0f2f5; --bg-card: #ffffff;
            --text-main: #2c3e50; --text-muted: #6c757d; --border-color: #e9ecef;
            --radius: 16px;
        }
        [data-theme="dark"] {
            --bg-body: #121212; --bg-card: #1e1e1e; --text-main: #f8f9fa;
            --text-muted: #adb5bd; --border-color: #333;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { background: var(--bg-body); color: var(--text-main); height: 100vh; overflow: hidden; transition: 0.3s; }
        .icon { font-size: 1.2rem; margin-right: 10px; }

        /* --- LAYOUT & COMPONENTES --- */
        .app-layout { display: flex; height: 100%; display: none; }
        #sidebar { width: 280px; background: var(--bg-card); display: flex; flex-direction: column; border-right: 1px solid var(--border-color); z-index: 2000; transition: 0.3s; }
        .brand { padding: 30px 25px; font-size: 1.4rem; font-weight: 700; color: var(--primary); display: flex; align-items: center; gap: 10px; }
        .menu-list { list-style: none; padding: 0 15px; flex: 1; }
        .menu-link { display: flex; align-items: center; padding: 12px 18px; color: var(--text-muted); border-radius: 12px; font-weight: 500; cursor: pointer; margin-bottom: 5px; transition: 0.2s; }
        .menu-link:hover, .menu-link.active { background: rgba(26, 115, 232, 0.1); color: var(--primary); font-weight: 600; }
        .user-info { padding: 20px; border-top: 1px solid var(--border-color); display: flex; align-items: center; gap: 12px; font-size: 0.9rem; }
        .user-avatar { width: 36px; height: 36px; border-radius: 50%; background: var(--primary); }

        .main-content { flex: 1; display: flex; flex-direction: column; overflow: hidden; position: relative; }
        header { background: var(--bg-card); padding: 15px 30px; display: none; justify-content: space-between; align-items: center; box-shadow: 0 4px 12px rgba(0,0,0,0.05); z-index: 1000; }
        .page-content { flex: 1; overflow-y: auto; padding: 30px; padding-bottom: 80px; }

        .card { background: var(--bg-card); padding: 25px; border-radius: var(--radius); box-shadow: 0 4px 12px rgba(0,0,0,0.05); margin-bottom: 25px; border: 1px solid var(--border-color); }
        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .summary-card { padding: 25px; background: var(--bg-card); border-radius: var(--radius); border: 1px solid var(--border-color); position: relative; overflow: hidden; }
        .summary-card.saldo { border-bottom: 4px solid var(--primary); }
        .summary-card.cartao { border-bottom: 4px solid var(--accent-purple); }
        .summary-val { font-size: 1.8rem; font-weight: 700; margin-top: 5px; }

        .table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: separate; border-spacing: 0; min-width: 600px; }
        th { text-align: left; color: var(--text-muted); padding: 15px; border-bottom: 2px solid var(--border-color); }
        td { padding: 15px; border-bottom: 1px solid var(--border-color); }

        .btn { padding: 12px 20px; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; transition: 0.2s; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-icon { background: rgba(0,0,0,0.05); border: none; cursor: pointer; padding: 8px; border-radius: 8px; color: var(--text-muted); }
        .form-control { width: 100%; padding: 12px; border: 2px solid var(--border-color); background: var(--bg-body); color: var(--text-main); border-radius: 10px; margin-bottom: 15px; outline: none; }
        .form-control:focus { border-color: var(--primary); background: var(--bg-card); }
        .label { font-weight: 600; margin-bottom: 5px; display: block; font-size: 0.9rem; }

        /* Login & Overlay */
        #login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-body); z-index: 9999; display: flex; justify-content: center; align-items: center; }
        .login-card { background: var(--bg-card); padding: 40px; border-radius: var(--radius); box-shadow: 0 10px 30px rgba(0,0,0,0.1); text-align: center; width: 90%; max-width: 400px; }
        #overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1500; opacity: 0; visibility: hidden; transition: 0.3s; }
        #overlay.visible { opacity: 1; visibility: visible; }
        .screen { display: none; animation: fadeIn 0.3s; } .screen.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        @media (max-width: 768px) { 
            #sidebar { position: fixed; top: 0; left: 0; height: 100%; transform: translateX(-100%); }
            #sidebar.open { transform: translateX(0); }
            header { display: flex; }
            .btn-close-menu { display: block !important; margin-top: 20px; color: var(--accent-red); text-align: center; cursor: pointer; font-weight: 600; }
        }
        .btn-close-menu { display: none; }
        
        #toast-container { position: fixed; top: 20px; right: 20px; z-index: 5000; }
        .toast { padding: 15px 20px; background: var(--bg-card); border-left: 5px solid var(--primary); box-shadow: 0 5px 15px rgba(0,0,0,0.1); border-radius: 8px; margin-bottom:10px; font-weight: 500; animation: slideIn 0.3s; }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }

        /* Estilos Cart√£o */
        .card-mini { display: flex; justify-content: space-between; align-items: center; padding: 15px; border: 1px solid var(--border-color); border-radius: 10px; margin-bottom: 10px; }
        .card-tag { font-size: 0.75rem; background: var(--accent-purple); color: white; padding: 3px 8px; border-radius: 4px; }
        .installments-badge { font-size: 0.75rem; background: #eee; padding: 2px 6px; border-radius: 4px; color: #555; }
    </style>
</head>
<body>

    <div id="toast-container"></div>

    <div id="login-screen">
        <div class="login-card">
            <h1 style="color:var(--primary); margin-bottom:10px;">FinControl v14</h1>
            <p style="color:var(--text-muted);">Acesso Seguro</p>
            <br>
            <button class="btn" style="background:white; border:1px solid #ddd; width:100%; display:flex; align-items:center; justify-content:center; gap:10px;" onclick="fazerLogin()">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="20"> Entrar com Google
            </button>
        </div>
    </div>

    <div class="app-layout" id="app-interface">
        <div id="overlay" onclick="toggleMenu(false)"></div>

        <aside id="sidebar">
            <div class="brand">üöÄ FinControl</div>
            <ul class="menu-list">
                <li><a class="menu-link active" onclick="navegar('dashboard', this)"><span class="icon">üìä</span> Vis√£o Geral</a></li>
                <li><a class="menu-link" onclick="navegar('lancamentos', this)"><span class="icon">üìù</span> Extrato</a></li>
                <li><a class="menu-link" onclick="navegar('adicionar', this)"><span class="icon">‚ûï</span> Novo</a></li>
                <li><a class="menu-link" onclick="navegar('cartoes', this)"><span class="icon">üí≥</span> Cart√µes</a></li>
                <li><a class="menu-link" onclick="navegar('config', this)"><span class="icon">‚öôÔ∏è</span> Config</a></li>
                <li><a class="menu-link" onclick="alternarTema()"><span class="icon">üåì</span> Tema</a></li>
                <li class="btn-close-menu" onclick="toggleMenu(false)">‚úï Fechar Menu</li>
            </ul>
            <div class="user-info">
                <img id="user-photo" class="user-avatar" src="" alt="">
                <div><div id="user-name" style="font-weight:600;">User</div><div onclick="auth.signOut()" style="color:var(--accent-red); cursor:pointer; font-size:0.8rem;">Sair</div></div>
            </div>
        </aside>

        <main class="main-content">
            <header>
                <strong>Gest√£o Financeira</strong>
                <button onclick="toggleMenu(true)" style="background:none; border:none; font-size:24px;">‚ò∞</button>
            </header>

            <div class="page-content">
                
                <section id="dashboard" class="screen active">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:25px; flex-wrap:wrap; gap:10px;">
                        <div><h2>Bom dia!</h2><p style="color:var(--text-muted); font-size:0.9rem;">Resumo de contas e cart√µes.</p></div>
                        <div style="display:flex; gap:10px;">
                            <input type="month" id="filtro-data" class="form-control" style="width:auto; margin:0;" onchange="renderizarInterface()">
                            <button class="btn" style="padding:10px;" onclick="limparFiltro()">Todos</button>
                        </div>
                    </div>

                    <div class="summary-grid">
                        <div class="summary-card saldo">
                            <span style="color:var(--text-muted); font-size:0.9rem;">Saldo (Dispon√≠vel)</span>
                            <div class="summary-val" id="dash-saldo">R$ 0,00</div>
                        </div>
                        <div class="summary-card cartao">
                            <span style="color:var(--text-muted); font-size:0.9rem;">Fatura (Venc. M√™s)</span>
                            <div class="summary-val" style="color:var(--accent-purple)" id="dash-fatura">R$ 0,00</div>
                        </div>
                        <div class="summary-card">
                            <span style="color:var(--text-muted); font-size:0.9rem;">Receitas</span>
                            <div class="summary-val" style="color:var(--accent-green)" id="dash-ent">R$ 0,00</div>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px;">
                        <div class="card" style="min-height:350px;"><h3>Categorias</h3><div style="height:250px;"><canvas id="grafico-rosca"></canvas></div></div>
                    </div>
                </section>

                <section id="lancamentos" class="screen">
                    <div style="display:flex; justify-content:space-between; margin-bottom:20px;"><h2>Extrato</h2><button class="btn btn-primary" onclick="exportarCSV()">üì• CSV</button></div>
                    <div class="card table-container"><table id="tabela-extrato"><thead><tr><th>Data</th><th>Desc</th><th>Pagamento</th><th>Valor</th><th>A√ß√£o</th></tr></thead><tbody></tbody></table></div>
                </section>

                <section id="adicionar" class="screen">
                    <h2>Novo Lan√ßamento</h2><br>
                    <div class="card" style="max-width:600px; margin:0 auto;">
                        <form id="form-transacao">
                            <input type="hidden" id="input-id">
                            
                            <div style="display:flex; gap:10px;">
                                <div style="flex:1;">
                                    <label class="label">Tipo</label>
                                    <select id="input-tipo" class="form-control" onchange="toggleCartaoFields()">
                                        <option value="saida">üí∏ Despesa</option>
                                        <option value="entrada">üí∞ Receita</option>
                                    </select>
                                </div>
                                <div style="flex:1;">
                                    <label class="label">M√©todo</label>
                                    <select id="input-metodo" class="form-control" onchange="toggleCartaoFields()">
                                        <option value="debito">üí≥ D√©bito/PIX</option>
                                        <option value="credito">üè¶ Cr√©dito (Fatura)</option>
                                    </select>
                                </div>
                            </div>

                            <div id="area-cartao" style="display:none; background:rgba(111,66,193,0.05); padding:15px; border-radius:10px; margin-bottom:15px; border:1px solid var(--accent-purple);">
                                <label class="label" style="color:var(--accent-purple)">Selecione o Cart√£o</label>
                                <select id="input-cartao-id" class="form-control"></select>
                                
                                <label class="label" style="color:var(--accent-purple)">Parcelas</label>
                                <select id="input-parcelas" class="form-control">
                                    <option value="1">1x (√Ä vista)</option>
                                    <option value="2">2x</option>
                                    <option value="3">3x</option>
                                    <option value="4">4x</option>
                                    <option value="5">5x</option>
                                    <option value="6">6x</option>
                                    <option value="10">10x</option>
                                    <option value="12">12x</option>
                                </select>
                            </div>

                            <label class="label">Descri√ß√£o</label>
                            <input type="text" id="input-desc" class="form-control" required placeholder="Ex: Notebook">
                            
                            <div style="display:flex; gap:10px;">
                                <div style="flex:1;"><label class="label">Categoria</label><select id="input-categoria" class="form-control"></select></div>
                                <div style="flex:1;"><label class="label">Valor Total</label><input type="number" step="0.01" id="input-valor" class="form-control" required></div>
                            </div>
                            
                            <label class="label">Data da Compra</label>
                            <input type="date" id="input-data" class="form-control" required>

                            <button type="submit" class="btn btn-primary" style="width:100%; margin-top:10px;" id="btn-salvar">Lan√ßar</button>
                        </form>
                    </div>
                </section>

                <section id="cartoes" class="screen">
                    <h2>Meus Cart√µes</h2><br>
                    <div class="card">
                        <div style="display:flex; gap:10px; align-items:flex-end; margin-bottom:20px;">
                            <div style="flex:2;"><label class="label">Nome (ex: Nubank)</label><input type="text" id="novo-card-nome" class="form-control" style="margin:0;"></div>
                            <div style="flex:1;"><label class="label">Dia Fech.</label><input type="number" id="novo-card-fech" class="form-control" placeholder="05" style="margin:0;"></div>
                            <div style="flex:1;"><label class="label">Dia Venc.</label><input type="number" id="novo-card-venc" class="form-control" placeholder="10" style="margin:0;"></div>
                            <button onclick="addCartao()" class="btn btn-primary">+</button>
                        </div>
                        <div id="lista-cartoes"></div>
                    </div>
                </section>

                <section id="config" class="screen">
                    <h2>Configura√ß√µes</h2><br>
                    <div class="card">
                        <h3>Categorias</h3>
                        <div style="display:flex; gap:10px; padding-bottom:20px;">
                            <input type="text" id="nova-cat-nome" class="form-control" placeholder="Nome" style="margin:0; flex:2;">
                            <button onclick="addCategoriaCloud()" class="btn btn-primary">Add</button>
                        </div>
                        <div id="lista-cats-config"></div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <script>
        // --- SUAS CHAVES DO FIREBASE (Configuradas) ---
        const firebaseConfig = {
            apiKey: "AIzaSyAXU77W9IhtnAlM_vMUEMgM9_WScjEQaVU",
            authDomain: "app-financeiro-c2984.firebaseapp.com",
            projectId: "app-financeiro-c2984",
            storageBucket: "app-financeiro-c2984.firebasestorage.app",
            messagingSenderId: "296730284016",
            appId: "1:296730284016:web:b327a149cf0a7c059ed735",
            measurementId: "G-4XWB5TYSY6"
        };

        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let user = null;
        let transacoes = [];
        let categorias = [];
        let cartoes = [];
        let chartInstance = null;

        auth.onAuthStateChanged((u) => {
            if (u) {
                user = u;
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('app-interface').style.display = 'flex';
                document.getElementById('user-name').innerText = user.displayName;
                document.getElementById('user-photo').src = user.photoURL;
                initListeners();
            } else {
                document.getElementById('login-screen').style.display = 'flex';
                document.getElementById('app-interface').style.display = 'none';
            }
        });

        function fazerLogin() {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider).catch(e => alert(e.message));
        }

        function initListeners() {
            db.collection('users').doc(user.uid).collection('transacoes').orderBy('data', 'desc')
                .onSnapshot(snap => { transacoes = snap.docs.map(d => ({ id: d.id, ...d.data() })); renderizarInterface(); });
            
            db.collection('users').doc(user.uid).collection('categorias').orderBy('nome', 'asc')
                .onSnapshot(snap => { categorias = snap.docs.map(d => ({ id: d.id, ...d.data() })); renderizarCats(); });

            db.collection('users').doc(user.uid).collection('cartoes')
                .onSnapshot(snap => { cartoes = snap.docs.map(d => ({ id: d.id, ...d.data() })); renderizarCartoes(); });
        }

        function toggleCartaoFields() {
            const tipo = document.getElementById('input-tipo').value;
            const metodo = document.getElementById('input-metodo').value;
            const area = document.getElementById('area-cartao');
            
            if(tipo === 'saida' && metodo === 'credito') {
                area.style.display = 'block';
                if(cartoes.length === 0) alert("Voc√™ precisa cadastrar um cart√£o na aba Cart√µes primeiro!");
            } else {
                area.style.display = 'none';
            }
        }

        function renderizarInterface() {
            const filtroData = document.getElementById('filtro-data').value;
            let dados = transacoes;
            if (filtroData) {
                const [ano, mes] = filtroData.split('-');
                dados = transacoes.filter(t => { const d = new Date(t.data+"T00:00:00"); return d.getMonth() === (parseInt(mes) - 1) && d.getFullYear() === parseInt(ano); });
            }

            let saldo = 0, fatura = 0, receita = 0, gastosCat = {};
            const tb = document.querySelector('#tabela-extrato tbody');
            tb.innerHTML = '';

            dados.forEach(t => {
                const val = parseFloat(t.val);
                if(t.tipo === 'entrada') {
                    receita += val; saldo += val;
                } else {
                    if(t.metodo === 'credito') fatura += val;
                    else saldo -= val;
                    gastosCat[t.cat] = (gastosCat[t.cat] || 0) + val;
                }

                let extraInfo = '';
                if(t.parcela) extraInfo = `<span class="installments-badge">${t.parcela}</span>`;
                else if(t.metodo === 'credito') extraInfo = `<span class="card-tag">Cr√©dito</span>`;

                tb.innerHTML += `<tr>
                    <td>${new Date(t.data+"T00:00:00").toLocaleDateString()}<br><small>${t.cat}</small></td>
                    <td>${t.desc}</td>
                    <td>${extraInfo}</td>
                    <td style="color:${t.tipo==='entrada'?'var(--accent-green)':'var(--accent-red)'}">R$ ${val.toFixed(2)}</td>
                    <td><button onclick="deletarItem('transacoes','${t.id}')" class="btn-icon" style="color:red">üóëÔ∏è</button></td>
                </tr>`;
            });

            document.getElementById('dash-saldo').innerText = `R$ ${saldo.toFixed(2)}`;
            document.getElementById('dash-fatura').innerText = `R$ ${fatura.toFixed(2)}`;
            document.getElementById('dash-ent').innerText = `R$ ${receita.toFixed(2)}`;
            renderizarGrafico(gastosCat);
        }

        function addCartao() {
            const nome = document.getElementById('novo-card-nome').value;
            const fech = parseInt(document.getElementById('novo-card-fech').value);
            const venc = parseInt(document.getElementById('novo-card-venc').value);
            if(nome && fech && venc) {
                db.collection('users').doc(user.uid).collection('cartoes').add({ nome, fech, venc });
                document.getElementById('novo-card-nome').value = '';
                alert("Cart√£o adicionado!");
            }
        }

        function renderizarCartoes() {
            const div = document.getElementById('lista-cartoes');
            const sel = document.getElementById('input-cartao-id');
            div.innerHTML = ''; sel.innerHTML = '';
            cartoes.forEach(c => {
                div.innerHTML += `<div class="card-mini"><b>${c.nome}</b> <small>Fecha dia ${c.fech} / Vence dia ${c.venc}</small> <button onclick="deletarItem('cartoes','${c.id}')" class="btn-icon" style="color:red;">‚úï</button></div>`;
                sel.innerHTML += `<option value="${c.id}" data-fech="${c.fech}" data-venc="${c.venc}" data-nome="${c.nome}">${c.nome}</option>`;
            });
        }

        document.getElementById('form-transacao').addEventListener('submit', (e) => {
            e.preventDefault();
            const btn = document.getElementById('btn-salvar');
            btn.innerText = "Processando..."; btn.disabled = true;

            const tipo = document.getElementById('input-tipo').value;
            const metodo = document.getElementById('input-metodo').value;
            const desc = document.getElementById('input-desc').value;
            const cat = document.getElementById('input-categoria').value;
            const valorTotal = parseFloat(document.getElementById('input-valor').value);
            const dataCompra = new Date(document.getElementById('input-data').value + "T12:00:00");

            const batch = db.batch();

            if (tipo === 'saida' && metodo === 'credito') {
                const cartaoId = document.getElementById('input-cartao-id').value;
                const parcelas = parseInt(document.getElementById('input-parcelas').value);
                const cartaoInfo = document.getElementById('input-cartao-id').options[document.getElementById('input-cartao-id').selectedIndex];
                const diaFechamento = parseInt(cartaoInfo.getAttribute('data-fech'));
                const diaVencimento = parseInt(cartaoInfo.getAttribute('data-venc'));
                const nomeCartao = cartaoInfo.getAttribute('data-nome');
                const valorParcela = valorTotal / parcelas;

                for (let i = 0; i < parcelas; i++) {
                    let dataVencimento = new Date(dataCompra);
                    let acrescimoMes = i;
                    if (dataCompra.getDate() >= diaFechamento) { acrescimoMes++; }
                    dataVencimento.setMonth(dataVencimento.getMonth() + acrescimoMes);
                    dataVencimento.setDate(diaVencimento);

                    const ref = db.collection('users').doc(user.uid).collection('transacoes').doc();
                    batch.set(ref, {
                        tipo, metodo, cat,
                        desc: `${desc} (${i+1}/${parcelas}) - ${nomeCartao}`,
                        val: valorParcela,
                        data: dataVencimento.toISOString().split('T')[0],
                        parcela: `${i+1}/${parcelas}`
                    });
                }
            } else {
                const ref = db.collection('users').doc(user.uid).collection('transacoes').doc();
                batch.set(ref, { tipo, metodo, desc, cat, val: valorTotal, data: document.getElementById('input-data').value });
            }

            batch.commit().then(() => {
                document.getElementById('form-transacao').reset();
                document.getElementById('input-data').value = new Date().toISOString().split('T')[0];
                alert("Lan√ßamento realizado!");
                navegar('dashboard');
            }).catch(e => alert(e)).finally(() => { btn.innerText = "Lan√ßar"; btn.disabled = false; });
        });

        function renderizarCats() {
            const div = document.getElementById('lista-cats-config');
            const sel = document.getElementById('input-categoria');
            div.innerHTML = ''; sel.innerHTML = '';
            categorias.forEach(c => {
                div.innerHTML += `<div style="padding:10px; border-bottom:1px solid #eee; display:flex; justify-content:space-between;">${c.nome} <button onclick="deletarItem('categorias','${c.id}')" class="btn-icon" style="color:red">‚úï</button></div>`;
                sel.innerHTML += `<option value="${c.nome}">${c.nome}</option>`;
            });
        }
        function addCategoriaCloud() {
            const nome = document.getElementById('nova-cat-nome').value;
            if(nome) { db.collection('users').doc(user.uid).collection('categorias').add({ nome }); document.getElementById('nova-cat-nome').value = ''; }
        }
        function deletarItem(col, id) { if(confirm("Excluir?")) db.collection('users').doc(user.uid).collection(col).doc(id).delete(); }
        
        function renderizarGrafico(dados) {
            const ctx = document.getElementById('grafico-rosca').getContext('2d');
            if(chartInstance) chartInstance.destroy();
            const labels = Object.keys(dados);
            const vals = Object.values(dados);
            const colors = ['#1a73e8','#28a745','#f1c40f','#6f42c1','#dc3545'];
            chartInstance = new Chart(ctx, { type: 'doughnut', data: { labels: labels.length?labels:['Vazio'], datasets: [{ data: vals.length?vals:[1], backgroundColor: labels.length?colors:['#eee'], borderWidth:0 }] }, options: { maintainAspectRatio: false, plugins: { legend: { position:'right' } } } });
        }

        function exportarCSV() {
            let csv = "Data,Descricao,Metodo,Categoria,Valor\n";
            transacoes.forEach(t => csv += `${t.data},"${t.desc}",${t.metodo},"${t.cat}",${t.val}\n`);
            const link = document.createElement("a");
            link.href = 'data:text/csv;charset=utf-8,' + encodeURI(csv);
            link.download = "relatorio.csv";
            link.click();
        }

        function limparFiltro() { document.getElementById('filtro-data').value = ''; renderizarInterface(); }
        function navegar(tela, el) { document.querySelectorAll('.screen').forEach(s => s.classList.remove('active')); document.getElementById(tela).classList.add('active'); if(el) { document.querySelectorAll('.menu-link').forEach(l => l.classList.remove('active')); el.classList.add('active'); } toggleMenu(false); }
        function toggleMenu(s) { const sb = document.getElementById('sidebar'), ov = document.getElementById('overlay'); if(s){ sb.classList.add('open'); ov.classList.add('visible'); } else { sb.classList.remove('open'); ov.classList.remove('visible'); } }
        function alternarTema() { const b = document.body; if(b.hasAttribute('data-theme')) { b.removeAttribute('data-theme'); localStorage.setItem('theme','light'); } else { b.setAttribute('data-theme','dark'); localStorage.setItem('theme','dark'); } }

        const hojeISO = new Date().toISOString().split('T')[0];
        document.getElementById('input-data').value = hojeISO;
        document.getElementById('filtro-data').value = hojeISO.slice(0, 7); 
        if(localStorage.getItem('theme')==='dark') document.body.setAttribute('data-theme','dark');
    </script>
</body>
</html>
